<!DOCTYPE html>
<html>
  <head>
    <title>Friends Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      h1 {
        text-align: center;
      }
      .section {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 20px;
      }
      ul li a {
        color: #4caf50;
      }
      .form-section form {
        display: flex;
        flex-direction: column;
      }
      .form-section input,
      .form-section button {
        padding: 10px;
        margin: 5px 0;
      }
      .list-section ul {
        list-style: none;
        padding: 0;
      }
      .list-section li {
        background: #eee;
        margin: 5px 0;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Friends Page</h1>
    <div id="welcome-message">Welcome</div>

    <div class="section">
      <h2>Pending Friend Requests</h2>
      <ul>
        <!-- Example of pending requests -->
        <li>
          John Doe (john@example.com) wants to be your friend.
          <button>Accept</button> <button>Decline</button>
        </li>
        <li>
          Jane Smith (jane@example.com) wants to be your friend.
          <button>Accept</button> <button>Decline</button>
        </li>
      </ul>
    </div>

    <div class="section form-section">
      <h2>Send a Friend Request</h2>
      <form action="/send-friend-request" method="post">
        <!-- <input
          type="email"
          name="requestEmail"
          placeholder="Your Email"
          required
        /> -->
        <input
          type="email"
          name="receiveEmail"
          placeholder="Friend's Email"
          required
          id="friend-request-input"
        />
        <button type="button" id="send-request-button">Send Request</button>
      </form>
    </div>

    <div class="section list-section">
      <h2>Friends List</h2>
      <ul id="friends-list"></ul>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Fetch session data for welcome message
        fetch("/api/session")
          .then((response) => response.json())
          .then((data) => {
            const welcomeMessage = document.getElementById("welcome-message");
            welcomeMessage.textContent = `Welcome ${data.user.email}`;
          })
          .catch((error) =>
            console.error("Error fetching session data:", error)
          );

        // Fetch friends list
        fetch("/api/friends-list")
          .then((response) => response.json())
          .then((data) => {
            const friendsList = document.getElementById("friends-list");
            friendsList.innerHTML = ""; // Clear any existing list items
            data.friends.forEach((friend) => {
              const listItem = document.createElement("li");
              listItem.textContent = `${friend.name} (${friend.friendemail})`;
              friendsList.appendChild(listItem);
            });
          })
          .catch((error) =>
            console.error("Error fetching friends list:", error)
          );

        // Add friend request functionality
        const friendRequestInput = document.getElementById('friend-request-input');
        const sendRequestButton = document.getElementById('send-request-button');

        sendRequestButton.addEventListener('click', () => {
          const receiverEmail = friendRequestInput.value.trim();
          if (receiverEmail) {
            fetch('/api/friend-request', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ receiverEmail })
            })
            .then(response => response.json())
            .then(data => {
              console.log('Friend request sent:', data);
              friendRequestInput.value = '';
            })
            .catch(error => console.error('Error sending friend request:', error));
          }
        });
      });
    </script>
  </body>
</html>