<!DOCTYPE html>
<html>
  <head>
    <title>Reviews Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      h1 {
        text-align: center;
      }
      .section {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 20px;
      }
      ul li a {
        color: #4caf50;
      }
      .form-section form {
        display: flex;
        flex-direction: column;
      }
      .form-section input,
      .form-section button {
        padding: 10px;
        margin: 5px 0;
      }
      .list-section ul {
        list-style: none;
        padding: 0;
      }
      .list-section li {
        background: #eee;
        margin: 5px 0;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Reviews Page</h1>
    <div id="welcome-message">Welcome</div>

    <div class="section form-section">
      <h2>Request a Review</h2>
      <form action="/request-review" method="post">
        <input
          type="email"
          name="userEmail"
          placeholder="User's Email"
          required
          id="review-request-input"
        />
        <button type="button" id="request-review-button">Request Review</button>
      </form>
    </div>

    <div class="section list-section">
      <h2>My Reviews</h2>
      <ul id="reviews-list"></ul>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Fetch session data for welcome message
        fetch("/api/session")
          .then((response) => response.json())
          .then((data) => {
            const welcomeMessage = document.getElementById("welcome-message");
            welcomeMessage.textContent = `Welcome ${data.user.email}`;
          })
          .catch((error) =>
            console.error("Error fetching session data:", error)
          );

        // Fetch user's reviews
        fetchReviews();

        // Add review request functionality
        const reviewRequestInput = document.getElementById('review-request-input');
        const requestReviewButton = document.getElementById('request-review-button');

        requestReviewButton.addEventListener('click', () => {
          const userEmail = reviewRequestInput.value.trim();
          if (userEmail) {
            requestReview(userEmail);
            reviewRequestInput.value = '';
          }
        });
      });

      function fetchReviews() {
        fetch("/api/my-reviews")
          .then((response) => response.json())
          .then((data) => {
            const reviewsList = document.getElementById("reviews-list");
            reviewsList.innerHTML = ""; // Clear any existing list items
            data.reviews.forEach((review) => {
              const listItem = document.createElement("li");
              listItem.textContent = `Review for ${review.userEmail}: ${review.content}`;
              const editButton = document.createElement("button");
              editButton.textContent = "Edit";
              editButton.onclick = () => editReview(review.id);
              const deleteButton = document.createElement("button");
              deleteButton.textContent = "Delete";
              deleteButton.onclick = () => deleteReview(review.id);
              listItem.appendChild(editButton);
              listItem.appendChild(deleteButton);
              reviewsList.appendChild(listItem);
            });
          })
          .catch((error) =>
            console.error("Error fetching reviews:", error)
          );
      }

      function requestReview(userEmail) {
        fetch("/api/request-review", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ userEmail }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Review requested:", data);
          })
          .catch((error) =>
            console.error("Error requesting review:", error)
          );
      }

      function editReview(reviewId) {
        // Implement edit review functionality
      }

      function deleteReview(reviewId) {
        // Implement delete review functionality
      }
    </script>
  </body>
</html>